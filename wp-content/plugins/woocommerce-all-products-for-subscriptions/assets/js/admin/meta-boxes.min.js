jQuery(function(_){var n,e=_("#wcsatt_data"),t=e.find(".general_scheme_options"),i=t.find("input#_wcsatt_allow_one_off"),s=t.find("select#_wcsatt_default_status"),a=t.find(".wcsatt_image_select__container"),c=t.find("textarea#_wcsatt_subscription_prompt"),o=e.find(".subscription_schemes"),r=o.find(".subscription_scheme"),p=r.length,d={message:null,overlayCSS:{background:""!==wcsatt_admin_params.post_id?"#fff":"#f1f1f1",opacity:.6}};function l(){0<r.length?(i.prop("disabled",!1),s.prop("disabled",!1),c.prop("disabled",!1)):(i.prop("checked",!0).change(),i.prop("disabled",!0),s.prop("disabled",!0),c.prop("disabled",!0)),m()}function u(){0<r.length?e.removeClass("planless"):e.addClass("planless"),1<r.length?e.addClass("more_than_one_plan"):e.removeClass("more_than_one_plan"),i.is(":checked")?e.addClass("onetime_enabled"):e.removeClass("onetime_enabled")}function h(){var t=_("select#product-type").val(),n=r.length;"subscription"!==t&&"variable-subscription"!==t&&(0<n?_(".subscription_one_time_shipping").show():_(".subscription_one_time_shipping").hide())}function m(){a.removeClass("disabled"),(1===r.length&&!i.is(":checked")||0===r.length&&i.is(":checked"))&&a.addClass("disabled")}function f(){r.each(function(t,n){_(".position",n).val(parseInt(_(n).index(".subscription_schemes .subscription_scheme"),10)),_(n).attr("rel",t)})}_.fn.wcsatt_init_help_tips=function(){_(this).find(".help_tip, .tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},_.fn.wcsatt_init_type_dependent_inputs=function(){var t=_("select#product-type").val(),n="variable"===t?wcsatt_admin_params.i18n_override_option_variable:wcsatt_admin_params.i18n_override_option,e="variable"===t?wcsatt_admin_params.i18n_inherit_option_variable:wcsatt_admin_params.i18n_inherit_option,i="variable"===t?wcsatt_admin_params.i18n_discount_description_variable:wcsatt_admin_params.i18n_discount_description;_(this).find('.subscription_pricing_method_input [value="inherit"]').text(e),_(this).find('.subscription_pricing_method_input [value="override"]').text(n),_(this).find(".subscription_price_discount .woocommerce-help-tip").attr("data-tip",i).wcsatt_init_help_tips()},_.fn.wcsatt_refresh_days_in_month=function(){var t,n,e=_(this),i=e.find(".satt_subscription_payment_sync_date_day"),s=e.find(".subscription_sync_annual"),a=parseInt(e.find(".wc_input_subscription_payment_sync_date_month").val(),10);a?(n=a,t=new Date(Date.UTC(2001,n,0)).getUTCDate(),i.val()>t&&i.val(t),i.attr({step:"1",min:"1",max:t}),s.addClass("subscription_sync_annual--synced")):s.removeClass("subscription_sync_annual--synced")},_.fn.wcsatt_refresh_scheme_lengths=function(){var t=_(this),e=t.find(".wc_input_subscription_length"),n=t.find(".wc_input_subscription_period"),i=t.find(".wc_input_subscription_period_interval"),s=e.val(),a=parseInt(i.val(),10),c=!1;e.empty(),_.each(wcsatt_admin_params.subscription_lengths[n.val()],function(t,n){0!=parseInt(t,10)&&0!=parseInt(t,10)%a||e.append(_("<option></option>").attr("value",t).text(n))}),e.children("option").each(function(){if(this.value==s)return!(c=!0)}),c?e.val(s):e.val(0)},""===wcsatt_admin_params.post_id&&(e.on("click","h3",function(){var t=_(this).closest(".wc-metabox"),n=t.find(".wc-metabox-content");t.hasClass("closed")?n.show():n.hide(),t.toggleClass("closed")}),e.find(".wc-metabox").each(function(){var t=_(this),n=t.find(".wc-metabox-content");t.hasClass("closed")&&n.hide()})),_.fn.wcsatt_refresh_sync_options=function(){var t=_(this),n=t.find(".wc_input_subscription_period"),e=t.find(".subscription_sync"),i=e.find(".subscription_sync_annual"),s=e.find(".subscription_sync_week_month"),a=s.find("select"),c=i.find("select"),o=n.val();"day"===o?(e.hide(),a.val(0),c.val(0).change()):(e.show(),"year"===o?(s.hide(),a.val(0),i.show()):(i.hide(),c.val(0).change(),a.empty(),_.each(WCSubscriptions.syncOptions[o],function(t,n){t||(n=wcsatt_admin_params.i18n_do_no_sync),a.append(_("<option></option>").attr("value",t).text(n))}),s.show()))},(n=a.find("li")).on("click",function(){if(a.hasClass("disabled"))return!1;var t=_(this);t.find("input").prop("checked",!0),n.removeClass("selected"),t.addClass("selected")}),i.on("change",function(){m()}),"yes"===wcsatt_admin_params.is_onboarding&&setTimeout(function(){_(".satt_options a").trigger("click")},500),_("select#product-type").change(function(){0<r.length&&r.wcsatt_init_type_dependent_inputs(),u(),l(),h()}).change(),e.on("woocommerce_subscription_schemes_changed",function(){r=o.find(".subscription_scheme"),f(),u(),l(),h()}).one("woocommerce_subscription_scheme_added",function(){e.removeClass("onboarding")}),o.on("change","select.subscription_pricing_method_input",function(){var t=_(this),n=t.closest(".subscription_scheme_product_data"),e=t.val();n.find(".subscription_pricing_method").hide(),n.find(".subscription_pricing_method_"+e).show()}).on("change",".wc_input_subscription_period",function(){var t=_(this).closest(".subscription_scheme");t.wcsatt_refresh_scheme_lengths(),t.wcsatt_refresh_sync_options()}).on("change",".wc_input_subscription_payment_sync_date_month",function(){_(this).closest(".subscription_scheme").wcsatt_refresh_days_in_month()}),e.on("click","span.scheme-remove",function(){var t=_(this).closest(".subscription_scheme");return t.find("*").off(),t.remove(),e.trigger("woocommerce_subscription_schemes_changed"),!1}).on("click",".remove_all",function(){return e.hasClass("no_plans")||(r.each(function(t,n){var e=_(n);e.find("*").off(),e.remove()}),e.trigger("woocommerce_subscription_schemes_changed")),!1}).on("click","button.add_subscription_scheme",function(){e.block(d),p++;var t={action:"wcsatt_add_subscription_scheme",post_id:wcsatt_admin_params.post_id,index:p,security:wcsatt_admin_params.add_subscription_scheme_nonce};return _.post(wcsatt_admin_params.wc_ajax_url,t,function(t){o.append(t.markup);var n=o.find(".subscription_scheme").last();n.wcsatt_init_type_dependent_inputs(),n.wcsatt_init_help_tips(),n.find("select.subscription_pricing_method_input").change(),e.unblock(),e.trigger("woocommerce_subscription_scheme_added",t),e.trigger("woocommerce_subscription_schemes_changed")},"json"),!1}),i.on("change",function(){_(this).is(":checked")?e.find(".wcsatt_default_status").show():e.find(".wcsatt_default_status").hide(),u()}).change(),_("#_nyp").on("change",function(){_(this).is(":checked")?o.addClass("is_nyp"):o.removeClass("is_nyp")}).change(),function(){o.find("select.subscription_pricing_method_input").change(),o.find('select.wc_input_subscription_payment_sync_date_month[value!="0"]').change();var t=r.get();t.sort(function(t,n){var e=parseInt(_(t).attr("rel"),10),i=parseInt(_(n).attr("rel"),10);return e<i?-1:i<e?1:0}),_(t).each(function(t,n){o.append(n)}),o.sortable({items:".subscription_scheme",cursor:"move",axis:"y",handle:"span.scheme-handle",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,n){n.item.css("background-color","#f6f6f6")},stop:function(t,n){n.item.removeAttr("style"),f()}})}()});